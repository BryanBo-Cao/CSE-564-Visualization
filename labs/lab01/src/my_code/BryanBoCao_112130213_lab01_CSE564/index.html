<!DOCTYPE html>
<!--
Student: Bryan Bo Cao
SBU ID: 112130213

Apply 3 color scheme from Cool Blues (https://www.canva.com/learn/100-color-combinations/),
which are (#003B46, #07575B, #66A5AD, #C4DFE6) to make the whole theme consistent.

Note that I watched the videos from https://www.youtube.com/watch?v=n5NcCoa9dDU&list=PL6il2r9i3BqH9PmbOf5wA5E1wOG3FT22p&index=1
and the code are based on the basics I learned from the videos.

Dataset:
College 777 data points, 18 dimensions
https://vincentarelbundock.github.io/Rdatasets/datasets.html

Reference:
https://getbootstrap.com/docs
https://www.w3schools.com
-->
<html lang="en">
<head>
  <!--  <script src="../d3.min.js"></script> Use D3 library from CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <style>
    .bar {
      fill: orange;
    }

    .bar:hover {
      fill: orangered ;
    }
    </style>
</head>
<body>

  <div class="page-header" align="center">
    <h2>Student: Bryan Bo Cao SBU ID: 112130213</h2>
    <hr>
    <p>Dataset: College 777 data points, 18 dimensions</p>


    <div id="dropdown_div">
      Select Attribute:
      <!-- <select id="dropdown_menu">
      		<option id="select_attribute" selected="selected" value="Private">Private</option>
      </select> -->
    </div>

  </div>

  <div class="container-fluid well">

    <div id="canvas">
      <!-- To canvas div for d3 -->
      <svg width="960" height="500"></svg>
    </div>

    <div id="canvas_script">

      <script>

        // parameters
        var w = window.innerWidth, h = window.innerHeight - 450;
        var canvas_w = w - 20, canvas_h = h - 320;
        var num_bin = 10;
        var my_colors = ["#003B46", "#07575B", "#66A5AD", "#C4DFE6"];
        var format_count = d3.format(",.0f");

        d3.csv("./data/College.csv", function(data) {

          var attributes = data.columns;
          attributes.shift(); // The first attribute is "", so we need to remove it.
          attributes.shift(); // clean data
          console.log(attributes)
          console.log(attributes.length)

          var attribute = attributes[0];
          var display_data = data.map(function(d) { return parseInt(d[attribute])});
          console.log(display_data)

          var canvas = d3.select("#canvas")
                          .append("svg")
                          .attr("width", canvas_w)
                          .attr("height", canvas_h);

          function init_barchart(display_data_values) {

            console.log("init_barchart()");

            var format_count = d3.format(",.0f");
            var svg = d3.select("svg");
            var padding = 20;
            var svg_w = svg.attr("width") - padding;
                svg_h = svg.attr("height") - padding;
            var g = svg.append("g")
                        .attr("transform", "translate(" + padding + ")");

            var x_min = d3.min(display_data_values),
                x_max = d3.max(display_data_values),
                x_range = [0, svg_w],
                x_domain = [0, x_max];

            var x = d3.scaleLinear()
                      .range(x_range)
              				.domain(x_domain);

            var hist = d3.histogram()
                          .domain(x_domain)
                          .thresholds(x.ticks(num_bin))
                          (display_data);

            var y_min = d3.min(hist, function(d) { return d.length; }),
                y_max = d3.max(hist, function(d) { return d.length; }),
                y_range = [svg_h, 0],
                y_domain = [0, y_max];

            var y = d3.scaleLinear()
                      .range(y_range)
                      .domain(y_domain);

            var color_range = [d3.rgb(my_colors[0]),
                                d3.rgb(my_colors[2])];
            var color_scale = d3.scaleLinear()
                                .domain([y_min, y_max])
                                .range(color_range);

            var bar_w = x(hist[0].x1) - x(hist[0].x0) - 50,
                bar_h = function(d) { return svg_h - y(d.length)},
                bar_c = function(d) { return color_scale(d.length)}, // bar color
                bar_t = function(d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")";}; // bar transform

            var bar = g.selectAll(".bar")
                .data(hist)
                .enter()
                .append("g")
                .attr("class", "bar")
                .attr("transform", bar_t);

            bar.append("rect")
                .attr("x", 1)
                .attr("width", bar_w)
                .attr("height", bar_h)
                .attr("fill", bar_c)
                .on('mouseover', function(d){
                    d3.select(this)
                      .transition()
                      .duration(500)
                      .attr("x", 1)
                      .attr("width", bar_w + 30)
                      .attr("height", 2000)
                })
                .on("mouseout", function(d){
                      d3.select(this)
                          .transition()
                          .duration(500)
                          .attr("x", 1)
                          .attr("width", bar_w)
                          .attr("height", bar_h);
                });

            bar.select("rect")
                .transition()
                .duration(0)
                .attr("width", bar_w)
                .attr("height", 0);

            svg.append("g")
                .attr("class", "xaxis")
                .attr("transform", "translate(0," + svg_h + ")")
                .call(d3.axisBottom(x));

            bar.select("rect")
                .transition()
                .duration(500)
                .attr("width", bar_w)
                .attr("height", bar_h)
                .attr("fill", bar_c);

          } // end of function init_barchart(display_data_values)

          function update_barchart(display_data_values) {

            console.log("update_barchart()");

            var format_count = d3.format(",.0f");
            var svg = d3.select("svg");
            var padding = 20;
            var svg_w = svg.attr("width") - padding;
                svg_h = svg.attr("height") - padding;

            var x_min = d3.min(display_data_values),
                x_max = d3.max(display_data_values),
                x_range = [0, svg_w],
                x_domain = [0, x_max];

            var x = d3.scaleLinear()
                      .range(x_range)
              				.domain(x_domain);

            var hist = d3.histogram()
                          .domain(x_domain)
                          .thresholds(x.ticks(num_bin))
                          (display_data_values);

            var y_min = d3.min(hist, function(d) { return d.length; }),
                y_max = d3.max(hist, function(d) { return d.length; }),
                y_range = [svg_h, 0],
                y_domain = [0, y_max];

            var y = d3.scaleLinear()
                      .range(y_range)
                      .domain(y_domain);

            var bar = svg.selectAll(".bar").data(hist);

            // Remove old data
            bar.exit().remove();

            var color_range = [d3.rgb(my_colors[0]),
                                d3.rgb(my_colors[2])];
            var color_scale = d3.scaleLinear()
                                .domain([y_min, y_max])
                                .range(color_range);

            var bar_w = x(hist[0].x1) - x(hist[0].x0) - 12,
                bar_h = function(d) { return svg_h - y(d.length)},
                bar_c = function(d) { return color_scale(d.length)}, // bar color
                bar_t = function(d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")";}; // bar transform

            bar.transition()
                .duration(500)
                .attr("transform", bar_t);

            console.log(display_data_values)

            bar.select("rect")
                .transition()
                .duration(500)
                .attr("width", bar_w)
                .attr("height", bar_h)
                .attr("fill", bar_c);

            // update x axis
            d3.selectAll(".xaxis").remove();
            svg.append("g")
                .attr("class", "xaxis")
                .attr("transform", "translate(0," + svg_h + ")")
                .call(d3.axisBottom(x));

            bar.exit().remove();
          } // end of function render_barchart(values)

          init_barchart(display_data);

          // Create a dropdown
          var dropdown_menu = d3.select("#dropdown_div");

          dropdown_menu.append("select")
                      .attr("id", "dropdown_id")
                      .selectAll("option")
                          .data(attributes)
                          .enter()
                          .append("option")
                          .attr("value", function(d){return d;})
                          .text(function(d){return d;});

          d3.select("select")
            .on("change",function(d){
              var attribute = d3.select("#dropdown_id").node().value;
              var display_data = data.map(function(d) {return parseInt(d[attribute])});
              update_barchart(display_data);
          });

        }) // end of d3.csv("./data/College.csv", function(data) {

      </script>
    </div>

  </div>

</body>
</html>
