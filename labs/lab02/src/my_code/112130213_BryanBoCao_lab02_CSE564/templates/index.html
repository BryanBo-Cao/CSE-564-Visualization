<!DOCTYPE html>
<!--
Student: Bryan Bo Cao
SBU ID: 112130213
Email: bo.cao.1@stonybrook.edu or boccao@cs.stonybrook.edu

Dataset:
College 777 data points, 18 dimensions
https://vincentarelbundock.github.io/Rdatasets/datasets.html

Reference:
https://getbootstrap.com/docs
https://www.w3schools.com
Flask code base from TA: https://github.com/hawkeye154/d3_flask_tutorial
https://bl.ocks.org/gordlea/27370d1eea8464b04538e6d8ced39e89
-->
<html lang="en">
<head>
    <!--  <script src="../d3.min.js"></script> Use D3 library from CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
    <style>
      #value_on_bar {
        font-size: 20px;
        background-color: #66A5AD;
        padding: .30em;
        color: white;
        border-radius: 6px;
        pointer-events: none;
        position: absolute;
      }

      .hidden {
        display: none;
      }

      text {
        font-family: sans-serif;
        font-size: 10px;
      }

      .line {
          fill: none;
          /* stroke: #66A5AD; */
          stroke-width: 5;
      }

      .overlay {
        fill: #07575B;
        pointer-events: all;
      }

      .dot {
          fill-opacity: .5;
      }

      .axis {
          font-size: 18px;
      }
      .title {
          font-size: 20px;
          background-color: #66A5AD;
      }
      .label {
          font-size: 18px;
          background-color: #66A5AD;
      }

    </style>
    <!-- load the d3.js library -->
    <script src="http://d3js.org/d3.v5.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

</head>

<body>
<div class="page-header" align="center">
  <div id="bar_div" style="background-color: #07575B;" width="960" height="80" class="well">
    <font color="white"><h4>Student: Bryan Bo Cao SBU ID: 112130213</h4></font>
  </div>
</div>

<div class="container-fluid well">
  <div id="canvas">
    <div id="part2_scree_div_id" align="center"></div>
    <hr/>
    <div id="part3_scatter_div_id" align="center"></div>
  </div>
</div><!-- end of <div class="container-fluid well"> -->

  <div id="canvas_script">
    <script>
      // ###########################################################################
      // ####                          parameters                               ####
      // ###########################################################################
      var curr_bar_w = -10; // initial value
      var max_bar_w = 70, min_bar_w = 10;
      var w = window.innerWidth, h = window.innerHeight - 450;
      var canvas_w = w - 20, canvas_h = h - 320;
      var my_colors = ["#003B46", "#07575B", "#66A5AD", "#C4DFE6"];

      // ###########################################################################
      // ####                Visualize Data from Backent                        ####
      // ###########################################################################
      var vis_data = {{ data | safe }}
      console.log(vis_data);
      console.log(vis_data.pca_all_data_explained_variance_ratio_);
      console.log(vis_data.pca_sampled_data_explained_variance_ratio_);
      console.log(vis_data.pca_ss_data_explained_variance_ratio_);

      // canvas
      // main area to display all different kinds of charts
      var canvas = d3.select("#canvas")
                      .append("svg")
                      .attr("width", canvas_w)
                      .attr("height", canvas_h);

      // Code base from TA
      // Set the dimensions of the canvas / graph
      var margin = {top: 30, right: 20, bottom: 30, left: 50},
                    width = 600 - margin.left - margin.right,
                    height = 270 - margin.top - margin.bottom;

      // Set the ranges
      var x_scale = d3.scaleLinear().range([0, width]);
      var y_scale = d3.scaleLinear().range([height, 0]);

      // scree plot
      scree_plot(vis_data.pca_all_data_explained_variance_ratio_, "All Data", my_colors[1]);
      scree_plot(vis_data.pca_sampled_data_explained_variance_ratio_, "Sampled Data", my_colors[2])
      scree_plot(vis_data.pca_ss_data_explained_variance_ratio_, "Stratified Sampled Data", "steelblue");

      // part3 scatter plot
      scatter_plot(vis_data.top2PACVectors_all_data_t, "All Data", my_colors[1]);
      scatter_plot(vis_data.top2PACVectors_sampled_data_t, "Sampled Data", my_colors[1]);
      // scatter_plot(vis_data.top2PACVectors_ss_data_t);

      // ===================== scree_plot -- start =====================
      function scree_plot(data, title, color){

          // Scale the range of the data
          // Apply margin convention
          var scree_svg_margin = {top: 50, right: 50, bottom: 50, left: 50},
              scree_svg_width = window.innerWidth - scree_svg_margin.left - scree_svg_margin.right,
              scree_svg_height = 300;
              scree_svg_x_axis_height = 210;
              // height = window.innerHeight - margin.top - margin.bottom;

          // Use the index as X scale
          var x_scale = d3.scaleLinear()
              .domain([0, data.length-1])
              .range([0, width]);

          // Use data value as Y scale
          var yScale = d3.scaleLinear()
              .domain([0, d3.max(data) + 0.1])
              .range([height, 0]);

          // generate lines
          var line = d3.line()
              .x(function(d, i) { return x_scale(i); })
              .y(function(d) { return y_scale(d.y); })

          // generate line data y->data_value
          var line_data = data.map(function(d) { return {"y": d} })
          // console.log(line_data)

          var scree_svg = d3.select("#part2_scree_div_id").append("svg")
                      .attr("width", scree_svg_width + scree_svg_margin.left + scree_svg_margin.right)
                      .attr("height", scree_svg_height)
                      .on("mouseover", function() {
                          d3.select(this).transition()
                              .duration(400)
                              .style("opacity", 1);})
                      .on("mouseout", function() {
                          d3.select(this).transition()
                              .duration(400)
                              .style("opacity", 0.4);})
                      .append("g")
                          .attr("transform",
                                "translate(" + (scree_svg_margin.left + 330) + "," +
                                                scree_svg_margin.top + ")")

          // Append x axis
          scree_svg.append("g")
              .attr("class", "x axis")
              .attr("transform", "translate(0," + scree_svg_height + ")")
              .call(d3.axisBottom(x_scale))
              .attr("transform", "translate(" + 0+ "," + scree_svg_x_axis_height + ")");

          // Append y axis
          scree_svg.append("g")
              .attr("class", "y axis")
              .call(d3.axisLeft(y_scale));

          // Append text to x axis
          scree_svg.append("text")
              .attr("class", "x axis")
              .attr("transform",
                    "translate(" + (scree_svg_margin.left + 220) + " ," +
                              (scree_svg_x_axis_height + 30) + ")")
                   .style("text-anchor", "middle")
                   .text("Principal Component")

          // Append text to y axis
          scree_svg.append("text")
              .attr("class", "y axis")
              .attr("transform",
                    "translate(" + (scree_svg_margin.left - 140) + " ," +
                              (scree_svg_x_axis_height - 110) + ")")
                    .style("text-anchor", "middle")
                    .text("Variance Ratio")

          // Append title
          scree_svg.append("text")
                .attr("class", "title")
                .attr("x", width / 2)
                .attr("y", 0 - (scree_svg_margin.top / 2))
                .attr("text-anchor", "middle")
                .attr("font-size", "150%")
                .text(title);

          // Append paths
          scree_svg.append("path")
              .datum(line_data) // bind data to lines
              .attr("d", line)
              .attr("class", "line")

          scree_svg.selectAll(".line")
              .attr("stroke", color);

          // Append a dot on each datapoint
          scree_svg.selectAll(".dot")
              .data(line_data)
              .enter().append("circle")
                  .attr("cx", function(d, i) { return x_scale(i) })
                  .attr("cy", function(d) { return y_scale(d.y) })
                  .attr("class", "dot")
                  .attr("r", 6);

      }
      // ===================== scree_plot -- end =====================

      // ===================== scatter_plot -- start =====================
      function scatter_plot(data, title, color){

          var scatter_svg_margin = {top: 50, right: 50, bottom: 50, left: 50},
              width = 500 - scatter_svg_margin.left - scatter_svg_margin.right,
              height = 500 - scatter_svg_margin.top - scatter_svg_margin.bottom;

          var x = d3.scaleLinear()
                    .range([0, width]);
          var y = d3.scaleLinear()
                    .range([height, 0]);

          var x_axis = d3.axisBottom(x);
          var y_axis = d3.axisLeft(y);

          var scatter_svg = d3.select("#part3_scatter_div_id").append("svg")
              .attr("width", width + scatter_svg_margin.left + scatter_svg_margin.right)
              .attr("height", height + scatter_svg_margin.top + scatter_svg_margin.bottom)
                .append("g")
                  .attr("transform", "translate(" + scatter_svg_margin.left + "," + scatter_svg_margin.top + ")");

              x.domain([-2, 2])
              y.domain([-2, 2])

              // Append x axis
              scatter_svg.append("g")
                  .attr("class", "x axis")
                  .attr("transform", "translate(0," + (height / 2) + ")") // center of the plot
                  .call(x_axis);

              // Append y axis
              scatter_svg.append("g")
                  .attr("class", "y axis")
                  .attr("transform", "translate(" + (width / 2) + ",0)") // center of the plot
                  .call(y_axis);

              // Append text to x axis
              scatter_svg.append("text")
                  .attr("class", "x axis")
                  .attr("transform",
                        "translate(" + (width / 2) + " ," +
                                  (-18) + ")")
                        .style("text-anchor", "middle")
                        .text("Component1")

              // Append text to y axis
              scatter_svg.append("text")
                    .attr("class", "y axis")
                    .attr("transform",
                          "translate(" + (scatter_svg_margin.left + width - 100) + " ," +
                                    (height / 2 + 40) + ")")
                          .style("text-anchor", "middle")
                          .text("Component0")

              // Append title
              scatter_svg.append("text")
                        .attr("class", "title")
                        .attr("x", width / 2)
                        .attr("y", height + 30)
                        .attr("text-anchor", "middle")
                        .attr("font-size", "150%")
                        .text(title);

              // Append data dots
              scatter_svg.selectAll(".dot")
                  .data(data)
                  .enter().append("circle")
                    .attr("cx", function(d) { return x(d[0]); })
                    .attr("cy", function(d) { return y(d[1]); })
                    .attr("class", "dot")
                    .attr("r", 3.5)
                    .attr("fill", color);

      }
      // ===================== scatter_plot -- end =====================

    </script>
</div>
</body>
</html>
